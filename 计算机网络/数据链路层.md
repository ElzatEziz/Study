# 数据链路层

**为什么需要数据链路层？**

首先，物理层解决了相邻结点(主机、路由器)透明传输比特的问题

但是物理层还有一些没有解决的问题：

- 传输错误问题
  - 发送端发送比特1，而接受端收到比特0，接受端无法知道接受的是否准确
- 谁接受的问题
  - 多个设备连接问题：谁能发送数据？数据发送给谁？谁负责接收和处理？
- 传输结束问题
  - 如果知道一组数据即将到来，如何知道数据何时结束？



**数据链路层的地位**

网络中的主机，交换机必须实现数据链路层

不同的链路层可能采用不同的数据链路层协议

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-22%2021.39.59.png)



## 1.数据链路层概述

### **数据链路层的信道类型**

- 点对点信道ppp	
  - 使用一对一的点对点通信方式
- 广播信道CSMA/CD协议
  - 使用一堆多的广播通信方式
  - 必须使用专用的共享信道协议来协调这些主机的数据发送。



**链路**：就是从一个结点到相邻结点的一段物理链路，而中间没有任何其他的交换结点

**数据链路**：是指把实现通信协议的硬件和软件加到链路上，就构成了数据链路。

**帧**： 数据链路上传输的数据包

数据链路层以帧为单位传输和处理是问题



### 数据链路层的三个重要问题

- 封装成帧
- 差错检测
- 可靠传输



**数据传输(从上到下)**

发送方把等待发送的数据通过

- 应用层： 封装成 应用层协议数据单元 交付给下层
- 运输层：接受上层的数据，为其添加运输层协议首部，使之成为运输层协议数据单元，交付给下层
- 网络层：接受上层的数据，为其添加网络层协议首部，使之成为网络层协议数据单元，交付给下层
- 数据链路层：接受上层的数据，为其添加帧头(数据链路层协议首部)，再给尾部添加一个帧尾 封装成帧，交付给下层
- 物理层：将构成帧的各比特转换成电信号发送到传输媒体



#### 使用点对点信道的数据链路层

##### (1) 封装成帧

**什么是封装成帧？**

是把上层交付的数据添加帧头和帧尾的操作叫做封装成帧



**为什么封装成帧？**

封装成帧的目的就是为了在链路上以帧为单元传送数据

> 数据链路不必考虑物理层如何实现比特传输的细节，甚至可以更简单的设想好像是沿着两个数据链路层沿着水平方向传输
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-22%2022.04.17.png)





**什么是帧？有什么作用**

帧 分为 帧头 和 帧尾

> - 帧头和帧尾包含重要的控制信息。例如：地址，类型，协议等
> - 帧头和帧尾的作用之一就是帧定界。也就是接收方从物理层交付的比特流中通过帧定界标志中提取出一个一个的帧

MTU：规定了所能传送的帧的数据部分长度上限

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2011.16.13.png)

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-22%2023.01.59.png)





##### (2) 可靠传输

数据链路层向上层提供的服务类型

- 可靠传输
  - 想办法实现发送方传输什么，接受方就能接收到什么
- 不可靠传输
  - 丢弃有误码的帧，然后什么都不做

问题：

> 数据包的误码是不可避免的，如果产生了误码，那么接收方就会废弃这个数据包，废弃后那就接受不到数据了吗？那为什么又有可靠传输的问题
>
> 直接废弃：不可靠传输
>
> 废弃后，给接受方给发送方通知帧，通知出现了误码 ：可靠传输

解决方法：

> 如果数据链路层向其上层提供的是可靠服务，那么就得保证接受方因为误码废弃数据包后还能接收到帧的正确的副本



- 有线链路误码率较低，所以为了减小开销，并不要求数据链路层向上层提供可靠传输服务，即使出现了误码，由上层处理
- 无限链路误码率高，因为易受干扰，所以要求数据链路层必须向上层提供可靠传输服务。



##### (3) 差错检测

**什么是差错检测？**

检测帧在传输过程中出现的误码



问题：

> 帧在传输过程中可能遭遇干扰后出现 *误码* (可能就是比特0变成了比特1或者是相反的)
>
> 那么出现误码后，目标主机是如何知道产生了误码呢？

解决办法:

>  1.奇偶校验
>
>  在待发送的数据后面添加1为奇偶校验位，使整个数据(包括所添加的校验位在内)中"1"的个数为奇数(奇校验)或偶数(偶校验)。
>
>  例如：接受双方约定使用奇校验，那么接收方在数据后面添加校验位使其整个数据中1的个数为奇数，接收方接收到比特流后进行奇校验，如果有一个误码，那么整个数据的1的个数会是偶数，接受方就不会接受数据。
>
>  但是，如果有两个误码那不就又是奇数了吗？
>
>  ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2011.53.36.png)
>
>  所以，如果有奇数个位发生误码，则奇偶性发生变化，可以检查出误码
>
>  但是，如果有偶数个位发生误吗，则奇偶性不会发生改变，从而检查不出误码，也成为漏检，所以一般不会使用这种检测方法



>  2.循环冗余码计算CRC
>
>  数据链路层在把上层交付的数据包封装成帧以后通过 循环冗余码计算CRC 出 帧检验序列FCS 并将其添加到尾部

> 冗余码的计算
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-22%2022.17.24.png)
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2012.03.51.png)
>
> 检错码只能检测出出现了错误，并不能定位错误，所以不能纠正错误，如果要纠正错误，可以采用冗余信息更多的纠错码，但是纠错码的开销很大，所以计算机网络中较少使用。



#### 使用广播信道的数据链路层

使用广播信道数据链路层除了点对点信道包含的三个问题外还有额外的一些问题。



##### (1) 编址

问题：

> 如图在一个总线型网络中，要是主机A要给主机C发送帧，那么主机B、D、E是如何知道帧不是传给它们的呢？主机C有什么怎么知道帧是传给它的？
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2010.56.42.png)

解决方法：

>  将帧的目的地址添加在帧中一起传输，例如以太网2的MAC帧，其首部的三个字段中，有两个字段跟地址有关，一个是目的地址，一个是源地址，各占6个字节
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2011.00.32.png)



##### (2) 碰撞

问题：

> 当时用总线时，多台主机同时使用总线传输帧时就会发生碰撞，这是广播信道的共享式局域网不可避免的一个问题![截屏2022-11-23 11.03.24](/Users/elzat/Library/Application Support/typora-user-images/截屏2022-11-23 11.03.24.png)

解决方法：

> 1.以太网采用的是一种媒体接入控制协议CSMA/CD(载波监听多点接入/碰撞检测)
>
> 2.用更高性能的，使用点对点链路和链路层交换机的交换式局域网，在有线的领域完全取代了共享式局域网
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2011.06.44.png)
>
> 那么交换式局域网完全取代了共享式局域网，那么就不使用共享式局域网了吗？还有现在家庭常用的无线局域网采用共享式局域网，那么有共享式局域网就会发生碰撞，解决碰撞就用前面所介绍的CSMA/CA协议
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2011.08.49.png)
>
> 



**帧头和帧尾**

前面有说过帧头和帧尾的作用就是帧定界，但是并不是每一种数据链路层协议的帧都包含帧定界标志，例如以太网2的MAC帧就没有帧定界

那么接收方如何从物理层交付的比特流中如何提取帧？

以太网的数据链路层通封装好MAC帧后交付给物理层，物理层给这个MAC帧前面添加8字节的前导码

> 前导码中的前七个字节为前同步吗(作用是使接受方的时钟同步)
>
> 之后的1字节帧开始定界符，表明其后面紧跟着的就是MAC帧
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2011.31.01.png)

那么如何代表一个帧结束呢？

以太网规定了帧间间隔时间为96比特的发送时间，因此MAC帧并不需要帧结束定界符



## 2.点对点协议PPP

### 1.PPP协议的特点

对于点对点的链路，目前使用的最广泛的数据链路层是点对点协议PPP

特点：能够在多种链路上运行：

- 串行的、并行的；
- 同步链路、异步链路
- 低速链路、高速链路
- 交换的（动态的）、非交换的(静态的)
- 电的、光的



### 2.PPP协议应满足的需求

1. 要简单 —— 不需要很多功能
2. 封装成帧 —— 必须规定特殊的字符作为帧定界符
3. 透明性 —— 必须保证数据传输的透明性
4. 多种网络层协议 —— 能够在同一条物理链路上同时支持多种网络层协议
5. 多种类型链路 —— 能够在多种类型的链路上运行
6. 差错检测 —— 能够对接受端收到的帧进行检测，并立即丢弃差错的帧
7. 检测连接状态 —— 能够及时自动检测出链路是否处于正常工作状态。
8. 最大传送单元 —— 必须对每一种类型的点对点链路设置最大传送单元MTU的标准默认值，促进各种实现之间的互操作性。
9. 网络层地址协商 —— 必须提供一种机制使通信的两个网络层实体能够通过协商知道或能够配置彼此的网络层地址
10. 数据压缩协商 —— 必须提供一种方法来写上使用数据压缩算法。



### 3.PPP 协议的组成

三个组成部分：

- 对各种协议数据报的封装方法(封装成帧)
- 链路控制协议LCP
  - 用于建立、配置以及测试数据链路的连接
- 一套网络控制协议NCPs
  - 其中的每一个协议支持不同网络层协议



### 4.PPP协议的帧格式

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2017.09.59.png)

首部：4个字段构成

- 标制(Flag)字段F：0x7E 。PPP帧的定界符
- 地址(Address)字段A：0xFF。实际上不起作用
- 控制(Control)字段C：通常置为0x03
- 协议字段。指明帧的数据部分送交哪个协议处理

尾部：2个字段构成

- 帧检验序列FCS：CRC计算出的校验位



### 5.PPP同步传输和异步传输

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2017.43.29.png)

### 6.透明传输问题

什么是透明传输？

指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样。

两种实现方式

- 面向字节的物理链路使用字节填充(或字符填充)的方法实现透明传输
- 面向比特的物理链路使用比特填充的方法实现透明传输

问题：

> 如果数据中的某个字节的二进制代码和帧头帧尾的二进制代码一样，导致接收方搞错了帧尾，提前结束了接受，导致数据错误怎么办？

解决方法：

> 面向字节的异步链路：字节填充法(插入"转义字符")
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2017.34.07.png)
>
> 面向比特的同步链路：比特填充法(插入"比特0")
>
> ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2017.35.00.png)



### 7.工作状态

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2017.39.21.png)



## 3.使用广播信道的数据链路层

### 1.局域网的数据链路层

#### (1)局域网的最主要特点：

- 网络为一个单位所拥有
- 地理范围和站点数目均有限

#### (2)局域网的优点：

- 具有广播功能，从一个站点可很方便的访问全网。
- 便于系统的扩展和逐渐的演变，各设备的位置可灵活调整和改变。
- 提高了系统的可靠性、可用性和生存性



#### (3)局域网的拓扑结构

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2017.56.14.png)

#### (4)传输媒体

- 双绞线
- 光纤
- 电信号



#### (5)媒体共享技术

静态划分信道

- 频分复用
- 时分复用
- 波分复用
- 码分复用

动态划分信道

- 随机接入：所有的用户可随机的发送信息
- 受控接入：用户必须服从一定的控制
  - 集中控制
  - 分散控制

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2018.01.14.png)



#### (6)以太网的两个标准

DIX Ethernet V2

- 是世界上第一个局域网产品（以太网）的规约

IEEE 802.3

- 是第一个IEEE的以太网标准

严格来说，“以太网”应当是指符合DIX Ethernet V2 标准的局域网。



#### (7)局域网数据链路层的两个子层

为了使数据链路层更好的适应多种局域网标准，所以IEEE802将局域网的数据链路层拆成两个字层

- 逻辑链路控制层LLC(Logical Link Control)子层
  - 与传输媒体无关
- 媒体接入控制MAC(Medium Access Control)
  - 与传输媒体有关

> 一般不考虑LLC层
>
> 由于TCP/IP体系经常使用的局域网是DIX Ethernet V2，而不是802.3标准中的几种局域网，因此802委员会制定的逻辑链路控制子层的作用已经不大了
>
> 很多厂商生产的适配器上就仅装有MAC协议而没有LLC协议

网络适配器(网卡)的作用：

> 进行串行/并行转换。
>
> 对数据进行缓存。
>
> 在计算机的操作系统安装设备驱动程序
>
> 实现以太网协议

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2018.13.17.png)



### 2.CSMA/CD协议

在早期的以太网，许多计算机通过一根总线相连，这么做易于实现广播通信，简单，可靠

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2018.28.29.png)

**如何在具有广播特性的总线上实现一对一的通信**

如图中的B向D发送数据，总线上的所有的工作的计算机都会检测到B发送的数据信号。

但是数据链路层把IP数据包封装成帧的时候，就把目的主机D的地址封装到帧头，只有这个枕头的目的地址字段和目标主机的适配器硬件地址一致时，才能接受这个数据帧

所以只有D能接受这个数据帧，其他的计算机可以收到，但是不能接受从而丢弃。



**这种总线上实现一对一的通信时有缺点：**

- 如果多个站点同时发送，就会产生碰撞或冲突，导致发送失败

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2018.37.08.png)



早期的以太网为了解决这个缺陷采用的是载波监听多址接入/碰撞检测协议，简称CSMA/CD协议

载波监听(CS)

- 每一个站在发送帧之前先要检测一下总线上是否有其他站点在发送帧("先说后听")
  - 若检测到总线空闲69比特时间，则发送这个帧
  - 若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后在发送

多址接入(MA)

- 多个站连接在一条总线上

碰撞检测(CD)

- 每一个正在发送帧的站 边发送变检测碰撞("边说边听")
  - 一旦发现总线上出现碰撞，则立即停止发送，退避一段随机事件后再次发送("一旦冲突，立即停说，等待时机，重新再说")



工作流程

<img src="https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2019.29.47.png" style="zoom:50%;" />



**争用期**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2019.33.57.png)



**强化碰撞 ： 人为干扰信号**

就是当发送帧的站点一旦检测到碰撞，除了立即停止发送帧外，还要再继续发送32比特或48比特的人为干扰信号，以便有足够多的碰撞信号使所有站点都能检测出碰撞。



**CSMA/CD重要特性**

使用CSMA/CD协议的以太网不能进行全双工通信而只能进行双向交替通信(半双工)

- 每个站在发送数据之后的一小段时间，存在着遭遇碰撞的可能性
- 这种发送的不确定性使整个以太网的平均通信量小于以太网的最高数据率



### 3.使用集线器的星型拓扑

传统以太网的传输媒体发展阶段：粗同轴电缆 -> 细同轴电缆 -> 双绞线

采用双绞线的以太网采用星型拓扑

在星型的中心则增加了一条可靠性非常高的设备，叫做集线器(HUB)

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2019.54.26.png)



**星型以太网的特点**

![截屏2022-11-23 19.55.39](/Users/elzat/Library/Application Support/typora-user-images/截屏2022-11-23 19.55.39.png)



**集线器**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2019.56.27.png)



#### 4.以太网的信道利用率

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2019.58.37.png)



以太网信道被占用的情况

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2019.59.47.png)



![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2020.01.08.png)



### 4.以太网的MAC层

（1）MAC层的硬件地址

硬件地址又称物理地址，或MAC地址

IEEE 802 标准为局域网规定了一种48位的全球地址，是指局域网上的每一台计算机中固化在适配器的ROM中的地址

> 如果连接在局域网上的主机或路由器安装有多个适配器，这样的主机或路由器就有多个“地址”。
>
> 更准确的说，这种48位“地址”应当是某个接口的标识符。

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2020.08.57.png)

- IEEE 注册管理机构RA负责向厂家分配前3各字节 —— 组织唯一标识符OUI
- 厂家自行指派后3个字节 —— 扩展标识符

> 必须保证生产出的适配器没有重复地址
>
> 地址被固化在适配器的ROM中



**MAC地址分类**

IEEE规定地址字段的第一字节的最低位为I/G（Individual/Group）位

单播MAC地址：

- 是指第一个字节的最低位是0的MAC地址，代表了一块特定的网卡

组播MAC地址：

- 是指第一个字节的最低位是1的MAC地址，代表了一组网卡
- 广播MAC地址：
  - 是指每一位都是1的MAC地址，广播MAC地址只是组播MAC地址的一个特例。代表了所有网卡

> 广播/组播地址只能作为目的地址使用



IEEE吧地址字段第一字节的最低第2位G/L(global/local)位

全球管理：G/L位= 0 。 厂商向IEEE购买的OUI都属于全球管理

本地管理：G/L位 = 1 。这是用户可任意分配网络上的地址



**适配器具有过滤功能**

适配器从网络上以混杂方式(只要听到有帧就都接受)每收到一个MAC帧，先用硬件检查帧中的MAC地址

如果是发往本站的帧，则收下，然后在进行其他的处理

否则将其丢弃，不再进行任何处理。

发往本站的帧:

- 单播帧 —— 一对一
- 广播帧 —— 一队全体
- 多播帧 —— 一对多



**以太网V2的MAC帧格式**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2020.25.31.png)



**无效的MAC帧**

- 数据字段的长度与长度字段的值不一致；
- 帧的长度不是整数个字节；
- 用收到的帧检验序列FCS查处有差错
- 数据字段的长度不在46～1500字节之间
- 有效的MAC帧长度为64～1518字节之间



**帧间最小间隔**

帧间最小间隔9.6微妙，相当于96比特的发送时间

这样做是为了使刚刚收到数据帧的站的接受缓存来得及清理，做好接受下一帧的准备。



**抓取以太网的帧**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2020.30.54.png)

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-23%2020.31.12.png)



## 4.扩展的以太网

### 1.在物理层扩展以太网

#### (1)使用光纤扩展

- 主机使用光纤和一堆光纤调制解调器连接到集线器
  - 很容易使主机和几公里以外的集线器相连接，成本较高

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2022.45.26.png)

####  (2)使用集线器扩展

- 用多个集线器连接成更大的以太网
  - 碰撞域：物理层的概念，指任何一台设备发送数据，其他设备在发送数据会与之产生冲突，这些设备的集合，称之为碰撞域或冲突域
- 优点：
  - 使原来属于不同碰撞域的计算机能够跨碰撞域通信。
  - 扩大了以太网覆盖的地理范围
- 缺点
  - 碰撞域增大了，总的吞吐量未提高
  - 如果使用不同的以太网技术（如数据率不同），那么就不能用集线器将他们互连起来



### 2.在数据链路层扩展以太网

**扩展以太网更常用的方法是在数据链路层进行。**

**早期使用网桥，现在使用以太网交换机：**

- 网桥工作在数据链路层
- 它根据MAC帧的目的地址对收到的帧进行转发和过滤
- 网桥收到一个帧时，不是向所有的接口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口，或把它丢弃
- 隔离碰撞域

**以太网交换机的特点**

- 接口数量多：
  - 交换是一个多接口的网桥，具有十几个或更多的接口
- 全双工工作：
  - 接口与一台主机或另一个交换机相连，工作在全双工方式
- 具有并行性：
  - 能同时连通多对接口，使多对主机能同时通信。
- 传输无冲突：
  - 相互通信的主机都是独占传输媒体，无碰撞地传输数据
- 接口存储器：
  - 接口有存储器，能在输出端口繁忙时把到来的帧进行缓存
- 能即插即用：
  - 即插即用设备，其内部的帧交换表是通过自学习算法自动的逐渐建立起来的
- 转发速率高：
  - 采用专用的交换结构芯片，硬件转发，转发速率比使用软件转发的网桥快很多，

**以太网交换机的交换方式**

- 存储转发
  - 把整个数据帧先缓存，检验正确性，正确转发，错误丢弃。延迟大，可靠性高，支持不同速率的端口交换。
- 直通方式
  - 检查数据帧的目的MAC地址之后立即转发，延迟小，可靠性低，不支持不同速率的端口交换
  - 缺点：不检查差错就直接将帧转发出去，有可能转发无效帧。

**交换机自学习和转发帧的步骤归纳**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.01.46.png)

**回路的产生**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.06.58.png)

**消除回路：使用生成树协议STP**

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.07.15.png)

**从总线以太网到星型以太网**

![截屏2022-11-26 23.08.20](/Users/elzat/Library/Application Support/typora-user-images/截屏2022-11-26 23.08.20.png)



### 3.虚拟局域网

以太网存在的问题：

- 广播风暴
  - 交换机之间的冗余链路形成广播风暴
    - ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.10.59.png)
  - 一个以太网是一个广播域
  - 广播域
    - 指这样一部分网路，其中任何一台设备发出的广播通信都能被该部分网络中的所有设备所接受
- 安全问题
  - 无法隔离不同部门的通信
  - 交换机每个接口都处于一个独立的碰撞域中，但所有的计算机都处于同一个广播域中
- 管理困难等



**虚拟局域网定义**

> 实际工作中，我们需要一种技术：部门内可以相互访问，部门间不能相互访问，使各部门从单一的广播域隔离出来，以增加网路安全性。
>
> 比如说：研发部可以在研发部部门内可以相互通信，但研发部部门内不能跟产品部门相互通信

IEEE 802.1Q对虚拟局域网VLAN的定义：

虚拟局域网VLAN是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个VLAN的帧都有一个明确的标识符，指明发送这个帧的计算机是属于哪一个VLAN。由以太网交换机实现；

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.20.48.png)

VLAN = 广播域 + 逻辑网段

虚拟局域网限制了接受广播信息的工作站数，使得网络不会因传播过多的广播信息而引起性能恶化。



**VLAN使用的以太网帧格式**

IEEE 802.3ac 标准等一了以太网帧格式的扩展，以支持虚拟局域网：

- 该协议允许在以太网帧格式中插入一个4字节的标识符，称为VLAN标记，用来指明发送该镇的计算机属于哪一个虚拟局域网；
- 插入VLAN标记得出的帧成为802.1Q帧，或带标记的以太网帧

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.22.19.png)



![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.26.02.png)



**虚拟局域技术具有以下主要优点：**

- 便于网络管理，具有相似需求的用户共享同一个VLAN
- 增强网络的安全性，敏感用户与普通用户隔离。
- 减少了不必要的网络流量
- 限制了广播报文的洪泛，抑制广播风暴
- 减少网络拓扑变更成本
- 降低计算机CPU的开销



**划分虚拟局域网的方法**

- 基于交换机端口划分
  - 最简单最常用的
  - 属于在第1层划分虚拟局域网的方法
  - 缺点：不允许用户移动
  - ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.30.48.png)
- 基于计算机网卡的MAC地址
  - 根据计算机的MAC地址划分局域网
  - 属于在第2层划分虚拟局域网的方法
  - 允许用户移动
  - 缺点：需要输入和管理大量的MAC地址。如果用户的MAC地址改变了，则需要管理员重新配置VLAN
  - ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.36.43.png)
- 基于协议类型
  - 根据以太网帧的第三个字段“类型”来确定该类型的协议属于哪一个虚拟局域网
  - 属于在第2层划分虚拟局域网的方法
  - ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.37.43.png)
- 基于IP子网地址
  - 根据以太网帧的第三个字段“类型”和IP分组首部中的源IP地址字段确定该IP分组属于哪一个虚拟局域网
  - 属于在第3层划分虚拟局域网的方法
  - ![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.39.26.png)
- 基于高层应用或服务
  - 根据高层应用或服务、活着它们的组合划分虚拟局域网
  - 更加灵活，但更加复杂
  - ![截屏2022-11-26 23.41.43](/Users/elzat/Library/Application Support/typora-user-images/截屏2022-11-26 23.41.43.png)



### 4.高速以太网

#### (1)100BASE-T 以太网

- 又称为快速以太网
- 在双绞线上传送100Mbit/s基带信号的星型拓扑以太网
- 仍使用CSMA/CD协议

特点：

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.44.16.png)



#### (2)吉比特以太网

特点：

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.45.36.png)



#### (3)10吉比特以太网和更快的以太网

特点：

![](https://gitee.com/zati/img-bed/raw/master/Img2/%E6%88%AA%E5%B1%8F2022-11-26%2023.46.44.png)



**端到端的以太网传输**

以太网的工作范围已经扩大到城域网和广域网，实现了端到端的以太网传输

好处：

- 技术成熟
- 操作性很好
- 广域网中使用以太网时价格便宜；
- 采用统一的以太网帧格式，简化了操作和管理。



#### (4)使用以太网进行宽带接入

以太网宽带接入的特点

- 可以提供双向的宽带通信
- 可以根据用户对带宽的需求灵活的进行带宽升级
- 可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。
- 但不支持用户身份鉴别



**PPPoE（PPP over Ehernet）**：

在以太网上运行PPP

- 将PPP帧封装到以太网中来传输
- 现在的光纤宽带接入FTTx 都要使用PPPoE的方式进行接入。
- 利用ADSL进行宽带上网时，从用户个人电脑到家中的ADSL调制解调器之间的连接也适用RJ-45和5类型，也适用PPPoE
